<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>å †æ’åº Heapsort - Rust Algorithm Club</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Learn algorithms and data structures with Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />


        <link rel="stylesheet" href="../../book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="../../_FontAwesome/css/font-awesome.css">

        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        

    </head>
    <body class="light">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = 'light'; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <ol class="chapter"><li class="affix"><a href="../../">Rust Algorithm Club</a></li><li><a href="../../concepts/">åŸºç¤æ¦‚å¿µ</a></li><li><ol class="section"><li><a href="../../concepts/asymptotic-notation.html">ğŸš§ æ¼¸é€²ç¬¦è™Ÿ Asymptotic Notation</a></li><li><a href="../../concepts/master-theorem.html">ğŸš§ ä¸»å®šç† Master Theorem</a></li><li><a href="../../concepts/algorithm-design.html">ğŸš§ æ¼”ç®—æ³•è¨­è¨ˆ Algorithm Design</a></li></ol></li><li><a href="../../sorting/">æ’åº</a></li><li><ol class="section"><li><a href="../../sorting/">ç°¡å–®æ’åº</a></li><li><ol class="section"><li><a href="../../sorting/insertion_sort/">æ’å…¥æ’åº Insertion sort</a></li><li><a href="../../sorting/selection_sort/">é¸æ“‡æ’åº Selection sort</a></li><li><a href="../../sorting/bubble_sort/">æ°£æ³¡æ’åº Bubble sort</a></li><li><a href="../../sorting/shellsort/">å¸Œçˆ¾æ’åº Shellsort</a></li></ol></li><li><a href="../../sorting/">é«˜æ•ˆæ’åº</a></li><li><ol class="section"><li><a href="../../sorting/heapsort/" class="active">å †æ’åº Heapsort</a></li><li><a href="../../sorting/quicksort/">å¿«é€Ÿæ’åº Quicksort</a></li><li><a href="../../sorting/mergesort/">åˆä½µæ’åº Mergesort</a></li></ol></li><li><a href="../../sorting/">æ··åˆæ’åº</a></li><li><ol class="section"><li><a href="../../sorting/introsort/">ğŸš§ å…§çœæ’åº Introsort</a></li><li><a href="../../sorting/timsort/">ğŸš§ è‡ªé©æ‡‰çš„åˆä½µæ’åº Timsort</a></li><li><a href="../../sorting/pdqsort/">ğŸš§ æ¨¡å¼æ¶ˆé™¤å¿«é€Ÿæ’åº Pdqsort</a></li></ol></li><li><a href="../../sorting/">ç‰¹æ®Šæ’åº</a></li><li><ol class="section"><li><a href="../../sorting/counting_sort/">è¨ˆæ•¸æ’åº Counting sort</a></li><li><a href="../../sorting/bucket_sort/">æ¡¶æ’åº Bucket sort</a></li><li><a href="../../sorting/radix_sort/">ğŸš§ åŸºæ•¸æ’åº Radix sort</a></li></ol></li></ol></li><li><a href="../../collections/">è³‡æ–™çµæ§‹</a></li><li><ol class="section"><li><a href="../../collections/linked_list/">éˆçµä¸²åˆ—</a></li><li><ol class="section"><li><a href="../../collections/linked_list/">ğŸš§ å–®å‘éˆçµä¸²åˆ— Singly linked list</a></li><li><a href="../../collections/linked_list/">ğŸš§ é›™å‘éˆçµä¸²åˆ— Doubly linked list</a></li><li><a href="../../collections/linked_list/">ğŸš§ å¾ªç’°éˆçµä¸²åˆ— Circular linked list</a></li></ol></li></ol></li><li><a href="../../LICENSE.html">æˆæ¬Šæ¢æ¬¾</a></li></ol>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light <span class="default">(default)</span></button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">Rust Algorithm Club</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <a class="header" href="#heapsort" id="heapsort"><h1>Heapsort</h1></a>
<p>Heapsortï¼ˆå †ç©æ’åºæ³•ï¼‰å¯ä»¥çœ‹ä½œæ˜¯ <a href="../selection_sort">selection sort</a> çš„è®Šå½¢ï¼ŒåŒæ¨£æœƒå°‡è³‡æ–™åˆ†ç‚º sorted pile èˆ‡ unsorted pileï¼Œä¸¦åœ¨ unsorted pile ä¸­å°‹æ‰¾æœ€å¤§å€¼ï¼ˆæˆ–æœ€å°å€¼ï¼‰ï¼ŒåŠ å…¥ sorted pile ä¸­ã€‚</p>
<p>å’Œ selection sort ä¸åŒä¹‹è™•æ˜¯ï¼Œheapsort åˆ©ç”¨ <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">heap</a> é€™ç¨®åŠæ’åºï¼ˆpartially sortedï¼‰çš„è³‡æ–™çµæ§‹è¼”åŠ©ä¸¦åŠ é€Ÿæ’åºã€‚</p>
<p>Heapsort çš„ç‰¹æ€§å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">heap</a> è³‡æ–™çµæ§‹è¼”åŠ©ï¼Œé€šå¸¸ä½¿ç”¨ <a href="https://en.wikipedia.org/wiki/Binary_heap">binary heap</a>ã€‚</li>
<li><strong>ä¸ç©©å®šæ’åº</strong>ï¼šæ’åºå¾Œï¼Œç›¸åŒéµå€¼çš„å…ƒç´ ç›¸å°ä½ç½®å¯èƒ½æ”¹è®Šã€‚</li>
<li><strong>åŸåœ°æ’åº</strong>ï¼šä¸éœ€é¡å¤–èŠ±è²»å„²å­˜ç©ºé–“ä¾†æ’åºã€‚</li>
<li><strong>è¼ƒå·®çš„ CPU å¿«å–</strong>ï¼šheap ä¸é€£çºŒå­˜å–ä½å€çš„ç‰¹æ€§ï¼Œä¸åˆ©æ–¼ <a href="https://en.wikipedia.org/wiki/CPU_cache">CPU å¿«å–</a>ã€‚</li>
</ul>
<a class="header" href="#algorithm" id="algorithm"><h2>Algorithm</h2></a>
<p>Heapsort çš„æ¼”ç®—æ³•åˆ†ç‚ºå…©å¤§æ­¥é©Ÿï¼š</p>
<ol>
<li>å°‡è³‡æ–™è½‰æ›ç‚º heap è³‡æ–™çµæ§‹ï¼ˆéå¢æ’åºç”¨ max-heap, éæ¸›æ’åºé¸æ“‡ min-heapï¼‰ã€‚</li>
<li>é€æ­¥å–å‡ºæœ€å¤§ï¼æœ€å°å€¼ï¼Œä¸¦èˆ‡æœ€å¾Œä¸€å€‹å…ƒç´ ç½®æ›ã€‚å…·é«”æ­¥é©Ÿå¦‚ä¸‹ï¼š
<ol>
<li>äº¤æ› heap çš„ root èˆ‡æœ€å¾Œä¸€å€‹ nodeï¼Œç¸®å° heap çš„ç¯„åœï¼ˆæ’åºä¸€ç­†è³‡æ–™ï¼Œæ•… heap é•·åº¦ -1ï¼‰ã€‚</li>
<li>æ›´æ–°å‰©ä¸‹çš„è³‡æ–™ï¼Œä½¿å…¶æ»¿è¶³ heap çš„ç‰¹æ€§ï¼Œç¨±ç‚º heap ordering propertyã€‚</li>
<li>é‡è¤‡å‰å…©å€‹æ­¥é©Ÿï¼Œç›´åˆ° heap ä¸­å‰©æœ€å¾Œä¸€å€‹æœªæ’åºçš„è³‡æ–™ã€‚</li>
</ol>
</li>
</ol>
<p>é€é GIF å‹•ç•«æ„Ÿå—ä¸€ä¸‹ heapsort çš„å¨åŠ›å§ï¼</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/1/1b/Sorting_heapsort_anim.gif" alt="" /></p>
<a class="header" href="#explanation" id="explanation"><h2>Explanation</h2></a>
<p>åœ¨é–‹å§‹ä¹‹å‰ï¼Œå®šç¾©å¹¾å€‹ heap å¸¸ç”¨åè©ï¼š</p>
<ul>
<li><strong>Heap ordering property</strong>ï¼šä¸€å€‹ heap å¿…é ˆè¦æ»¿è¶³çš„æ¢ä»¶ã€‚ä»¥ heap ç¨®é¡ä¸åŒæœ‰å¹¾ç¨®è®Šå½¢ã€‚
<ul>
<li><strong>min-heap property</strong>ï¼šæ¯å€‹çµé»çš†å¤§æ–¼ç­‰æ–¼å…¶çˆ¶ç¯€é»çš„å€¼ï¼Œä¸”æœ€å°å€¼åœ¨ heap rootã€‚</li>
<li><strong>max-heap property</strong>ï¼šæ¯å€‹çµé»çš†å°æ–¼ç­‰æ–¼å…¶çˆ¶ç¯€é»çš„å€¼ï¼Œä¸”æœ€å¤§å€¼åœ¨ heap rootã€‚</li>
</ul>
</li>
</ul>
<p>è€Œ heapsort ä¸»è¦åˆ†ç‚ºå…©å€‹éƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>Heapify</strong>ï¼šå°‡é™£åˆ—è½‰æ›ç‚º heap è³‡æ–™çµæ§‹ï¼ˆheapifyï¼‰ã€‚</li>
<li><strong>Sorting</strong>ï¼šä¸æ–·ç½®æ› heap root èˆ‡æœ€å¾Œä¸€å€‹å…ƒç´ ä¾†æ’åºï¼Œä¸¦ä¿®æ­£å‰©é¤˜æœªæ’åºè³‡æ–™ä½¿å…¶ç¬¦åˆ heap orderã€‚</li>
</ol>
<p>é€™è£¡æœ‰ä¸€å€‹æœªæ’åºçš„åºåˆ—ï¼Œå°‡ä»¥éå¢æ–¹å‘æ’åºä¹‹ã€‚</p>
<pre><code>[17, 20, 2, 1, 3, 21]
</code></pre>
<p>é¦–å…ˆï¼Œå°‡è³‡æ–™è½‰æ›ç‚º heap è³‡æ–™çµæ§‹ï¼Œé€™å€‹æ­¥é©Ÿå³æ™‚ <strong>heapify</strong>ã€‚ç”±æ–¼æ˜¯éå¢æ’åºï¼Œæˆ‘å€‘æ¡ç”¨ max-heapï¼ˆæœ€å¤§å…ƒç´ åœ¨ rootï¼‰ã€‚</p>
<pre><code>[21, 20, 17, 1, 3, 2]
</code></pre>
<p>å°æ‡‰çš„äºŒå…ƒæ¨¹ï¼ˆbinary treeï¼‰çš„åœ–å½¢å¦‚ä¸‹ï¼š</p>
<p><img src="tree.png" height="300px" /></p>
<p>å†ä¾†å°±æ˜¯<strong>æ’åºçš„éƒ¨åˆ†</strong>ï¼ŒMax-heap æœƒå°‡æœ€å¤§çš„å…ƒç´ æ“ºåœ¨ root çš„ä½ç½®ï¼Œæˆ‘å€‘å…ˆå°‡æœ€å¾Œä¸€å€‹ node èˆ‡ root é€²è¡Œäº¤æ›ï¼Œå®Œæˆç¬¬ä¸€å€‹æ’åºæ­¥é©Ÿã€‚</p>
<blockquote>
<p>è‹¥ä¸ç†Ÿæ‚‰ heapï¼Œå¯ä»¥é–±è®€<a href="https://en.wikipedia.org/wiki/Heap_(data_structure)"> Wiki çš„ä»‹ç´¹</a>ï¼Œå…¶å¯¦ heap å°±æ˜¯ç”¨é™£åˆ—å¯¦ä½œçš„äºŒå…ƒæ¨¹ã€‚</p>
</blockquote>
<pre><code>[21, 20, 17, 1, 3, 2]
 *                 *
(swap) --&gt;

        unsorted | sorted
[2, 20, 17, 1, 3 | 21]
</code></pre>
<p>æ¥ä¸‹ä¾†ï¼Œå°‡æœªæ’åºçš„è³‡æ–™å€å¡Šé‡æ•´ç‚ºç¬¦åˆ max-heap çš„çµæ§‹ã€‚</p>
<pre><code>[2, 20, 17, 1, 3 | 21]

(sift down) --&gt;

[20, 3, 17, 1, 2 | 21]
</code></pre>
<p>æœ‰æ²’æœ‰çœ‹å‡ºä¸€äº›ç«¯å€ªï¼Ÿ</p>
<p>åªè¦ä¸æ–·å°‡ root å’Œæœ€å¾Œä¸€å€‹ node äº¤æ›ï¼Œä¸¦å°‡å‰©é¤˜è³‡æ–™ä¿®æ­£è‡³æ»¿è¶³ heap orderingï¼Œå°±å®Œæˆæ’åºäº†ã€‚</p>
<pre><code>[20, 3, 17, 1, 2 | 21]
 *             *
(swap) --&gt;

[2, 3, 17, 1 | 20, 21]

(sift down)--&gt;

[17, 3, 2, 1 | 20, 21]
 *         *
(swap) --&gt;

[1, 3, 2 | 17, 20, 21]

(sift down)--&gt;

[3, 1, 2 | 17, 20, 21]
 *     *
(swap) --&gt;

[1, 2 | 3, 17, 20, 21]

(Done!)
</code></pre>
<p>ä»¥ä¸Šä¾¿æ˜¯ heapsort æ¼”ç®—æ³•çš„ç°¡å–®æµç¨‹ï¼Œæ˜¯ä¸æ˜¯å’Œ selection sort éå¸¸ç›¸ä¼¼å‘¢ï¼</p>
<a class="header" href="#performance" id="performance"><h2>Performance</h2></a>
<table><thead><tr><th align="left">              </th><th align="left"> Complexity         </th></tr></thead><tbody>
<tr><td align="left"> Worst        </td><td align="left"> \(O(n \log n) \)      </td></tr>
<tr><td align="left"> Best         </td><td align="left"> \(\Omega(n \log n) \) </td></tr>
<tr><td align="left"> Average      </td><td align="left"> \(\Theta(n \log n) \) </td></tr>
<tr><td align="left"> Worst space  </td><td align="left"> \(O(1) \) auxiliary   </td></tr>
</tbody></table>
<p>Heapsort æœ€ä½³ã€æœ€å·®ã€å¹³å‡çš„æ™‚é–“è¤‡é›œåº¦çš†ç‚º \(O(n \log n) \)ï¼ŒåŒæ¨£åˆ†ç‚ºå…©éƒ¨åˆ†ç°¡å–®è§£é‡‹ã€‚</p>
<a class="header" href="#build-heap-heapify" id="build-heap-heapify"><h3>Build heap (heapify)</h3></a>
<p>å»ºç«‹ä¸€å€‹ binary heap æœ‰å…©ç¨®æ–¹æ³•ï¼Œä¸€ç¨®æ˜¯ä¸€å€‹å€‹å…ƒç´ æ…¢æ…¢åŠ å…¥ heap ä¾†å»ºç«‹ï¼›å¦ä¸€ç¨®å‰‡æ˜¯çµ¦å®šéš¨æ„çš„åºåˆ—ï¼Œå†é€é heapify æ¼”ç®—æ³•ä¿®æ­£åºåˆ—ç‚ºæœ‰æ•ˆçš„ heapã€‚ä¸€èˆ¬ä¾†èªª heapsort å¸¸ç”¨å¯¦ä½œå¾Œè€…ã€‚</p>
<p><strong>Heapify</strong> æ˜¯æŒ‡å°‡åºåˆ—ä¿®æ­£è‡³ç¬¦åˆ heap ordering çš„åºåˆ—ã€‚çµ¦å®šä¸€å€‹å…ƒç´ ï¼Œå‡å®šå…¶ç‚ºéæ³•çš„ heap orderï¼Œè€Œè©²å…ƒç´ ä¹‹å¾Œçš„ subtree è¦–ç‚ºç¬¦åˆ heap ordering propertyã€‚æ¬²ä¿®æ­£é€™å€‹åœ¨éŒ¯èª¤ä½ç½®çš„å…ƒç´ ï¼Œå¿…é ˆé€éèˆ‡å…¶ children node ç½®æ›å¾€ä¸‹ç¯©ï¼Œé€™å€‹å¾€ä¸‹ç¯©çš„éç¨‹å°±ç¨±ç‚º <strong>sift down</strong>ï¼Œåœ¨<a href="#Implementation">å¯¦ä½œ</a>ä¸€ç¯€æœƒè©³ç´°è§£é‡‹ï¼Œé€™é‚Šåªè¦çŸ¥é“ sift down æœƒä¸æ–·å°‡è©²å…ƒç´ èˆ‡å…¶ child node æ¯”è¼ƒï¼Œè‹¥ä¸ç¬¦åˆ heap order å‰‡èˆ‡ child node ç½®æ›ï¼Œä¸¦ç¹¼çºŒè¿­ä»£æ¯ä¸€å€‹ levelã€‚æ‰€ä»¥ sift down çš„æ™‚é–“è¤‡é›œåº¦ç‚º \(O(\lceil {\log_2(n)} \rceil) = O(\log n) \)ï¼Œ \(n \) ç‚ºé™£åˆ—å…ƒç´ å€‹æ•¸ã€‚</p>
<p>Heapify å¾æœ€æœ«å€‹å…ƒç´ é–‹å§‹åå‘è¿­ä»£ï¼Œæ¯å€‹å…ƒç´ éƒ½èª¿ç”¨ <code>sift_down</code> èª¿æ•´ heap ç¬¦åˆ heap orderingã€‚ç¸½å…±è¦åš \(n \) æ¬¡ <code>sift_down</code> æ“ä½œï¼Œä½†ç”±æ–¼æœ€å¾Œä¸€å±¤æ‰€ä»¥ leaf å·²ç¬¦åˆ heap orderï¼ˆå› ç‚ºæ²’æœ‰ child nodeï¼‰ï¼Œæˆ‘å€‘çš„è¿´åœˆå¯ä»¥è·³éæ‰€æœ‰ leaf node ç›´æ¥å¾é leaf node é–‹å§‹ï¼Œå› æ­¤è¤‡é›œåº¦ç‚º</p>
<p>$$\lfloor n / 2 \rfloor \cdot O(\log n) = O(n \log n)$$</p>
<blockquote>
<p>å¯¦éš›ä¸Šï¼Œbuild heap æ­¥é©Ÿçš„è¤‡é›œåº¦å¯é”åˆ° \(\Theta(n) \)ï¼Œå¯ä»¥çœ‹çœ‹ UMD æ¼”ç®—æ³•èª²ç¨‹ <a href="http://www.cs.umd.edu/%7Emeesh/351/mount/lectures/lect14-heapsort-analysis-part.pdf">Lecture note çš„åˆ†æ</a>ã€‚</p>
</blockquote>
<a class="header" href="#sorting-sift-down" id="sorting-sift-down"><h3>Sorting (sift down)</h3></a>
<p>è¬›å®Œäº† heapifyï¼Œå°±æ›åˆ°æ’åºéƒ¨åˆ†ï¼Œæ‰€è¬‚çš„æ’åºå…¶å¯¦å°±æ˜¯åˆ©ç”¨ max-heapï¼ˆæˆ– min-heapï¼‰çš„æœ€å¤§å€¼ï¼ˆæœ€å°å€¼ï¼‰æœƒåœ¨é¦–å€‹å…ƒç´ çš„ç‰¹æ€§ï¼Œèˆ‡æœ€å¾Œä¸€å€‹å…ƒç´ ç½®æ›ï¼Œå®Œæˆæ’åºï¼Œä¸¦å°‡å‰©é¤˜çš„éƒ¨åˆ†é€é <strong>sift down</strong> ä¿®æ­£ç¬¦åˆ heap orderã€‚æ‰€ä»¥ç¸½å…±éœ€è¦åš \(n \) æ¬¡ sift downï¼Œè¤‡é›œåº¦ç‚º \(O(n \log n) \)ã€‚</p>
<a class="header" href="#sum-up" id="sum-up"><h3>Sum up</h3></a>
<p>ç¶œåˆé€™å…©éƒ¨åˆ†ï¼Œå¯ä»¥çœ‹å‡º Sorting part å°è¤‡é›œåº¦æœ‰æ±ºå®šæ€§å½±éŸ¿ï¼Œæœ€ä½³è¤‡é›œåº¦ç‚º \(O(n \log n) \)ã€‚</p>
<a class="header" href="#implementation" id="implementation"><h2>Implementation</h2></a>
<p>Heapsort çš„å¯¦ä½œç›¸å°ç°¡å–®ï¼Œåªéœ€è¦ä¸æ–·èª¿ç”¨ heap å…§éƒ¨çš„ <code>sift_down</code> æ–¹æ³•å°±å¯ä»¥å®Œæˆæ’åºã€‚æ•´å€‹æ¼”ç®—æ³•æ¶æ§‹å¦‚ä¸‹ï¼š</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
pub fn heapsort(arr: &amp;mut [i32]) {
    // -- Heapify part --
    // This procedure would build a valid max-heap.
    // (or min-heap for sorting descendantly)
    let end = arr.len();
    for start in (0..end / 2).rev() {                   // 1
        sift_down(arr, start, end - 1);
    }

    // -- Sorting part --
    // Iteratively sift down unsorted part (the heap).
    for end in (1..arr.len()).rev() {                   // 2
        arr.swap(end, 0);                               // 3
        sift_down(arr, 0, end - 1);                     // 4
    }
}
#}</code></pre></pre>
<ol>
<li>é€™éƒ¨åˆ†æ˜¯ heapifyï¼Œå¾æœ€å° non-leaf node é–‹å§‹ï¼ˆ<code>end</code> / 2ï¼‰ï¼Œä¿®æ­£åºåˆ—è‡³æ»¿è¶³ heap orderï¼Œå†åå‘è¿­ä»£åš heapifyã€‚</li>
<li>é€™éƒ¨åˆ†è² è²¬æ’åºï¼Œæ¯æ¬¡è¿­ä»£éƒ½å°‡æ’åº heap çš„ root å…ƒç´ ï¼Œæ­¥é©Ÿå¦‚ 3 - 4ï¼š</li>
<li>ä¸æ–·å°‡ max-heap ä¸­æœ€å¤§å€¼ï¼ˆåœ¨ root ä¸Šï¼‰èˆ‡ heap æœ€å¾Œä¸€å€‹å…ƒç´  <code>end</code> ç½®æ›ï¼Œ</li>
<li>ä¸¦åˆ©ç”¨ <code>sift_down</code> å°‡åºåˆ—ä¿®æ­£è‡³ max-heap è³‡æ–™çµæ§‹ï¼Œä¾ç…§å®šç¾©ï¼Œæ­¤æ™‚ unsorted pile é¦–å€‹å…ƒç´ æˆç‚º max-heap rootï¼Œæ˜¯æœ€å¤§å€¼ã€‚</li>
</ol>
<p>Heapsort å…¨é  <code>sift_down</code> ç¥æ•‘æ´ï¼Œé‚£ <code>sift_down</code> åˆ°åº•æœ‰ä»€éº¼ç¥å¥‡é­”åŠ›ï¼Œä¸€æ¢ç©¶ç«Ÿå§ï¼</p>
<pre><pre class="playpen"><code class="language-rust">
# #![allow(unused_variables)]
#fn main() {
fn sift_down(arr: &amp;mut [i32], start: usize, end: usize) {
    let mut root = start;
    loop {
        let mut child = root * 2 + 1; // Get the left child   // 1
        if child &gt; end {
            break;
        }
        if child + 1 &lt;= end &amp;&amp; arr[child] &lt; arr[child + 1] {  // 2
            // Right child exists and is greater.
            child += 1;
        }

        if arr[root] &lt; arr[child] {                           // 3
            // If child is greater than root, swap'em!
            arr.swap(root, child);
            root = child;
        } else {
            break;
        }
    }
}
#}</code></pre></pre>
<p><code>sift_down</code> çš„åŠŸèƒ½æ˜¯å°‡ node å¾€ä¸‹ç§»ã€‚é€šå¸¸ç”¨åœ¨ heap åˆªé™¤æˆ–å–ä»£ node æ™‚ï¼Œå°‡åºåˆ—ä¿®æ­£ç‚ºæœ‰æ•ˆçš„ heapã€‚ é€™è£¡å¯¦ä½œçš„ç‰ˆæœ¬æœ‰ä¸‰å€‹åƒæ•¸ï¼š</p>
<ul>
<li><code>arr</code>ï¼šæ¬²ä¿®æ­£ç‚ºç¬¦åˆ heap å®šç¾©çš„åºåˆ—ã€‚</li>
<li><code>start</code>ï¼šæ¬²å¾€ä¸‹ç§»å‹•çš„ node indexï¼Œå¯è¦–ç‚ºéœ€è¦è¢«ä¿®æ­£çš„å…ƒç´ ã€‚</li>
<li><code>end</code>ï¼šæ­¤ node ä»¥å…§ï¼ˆåŒ…å«ï¼‰çš„åºåˆ—éƒ½æœƒè¢«ä¿®æ­£ç‚ºæœ‰æ•ˆçš„ heapã€‚</li>
</ul>
<p><code>sift_down</code> æœ‰äº›å‡è¨­æ¢ä»¶ï¼šå¾ <code>start</code> index å‡ºç™¼çš„å­æ¨¹ï¼Œé™¤äº† <code>start</code> æœ¬èº«ä»¥å¤–ï¼Œå…¶ä»–çš†ç¬¦åˆ heap orderingã€‚</p>
<p>å†ä¾†çœ‹çœ‹ <code>sift_down</code> å¯¦ä½œå…§å®¹ï¼Œ<code>loop</code> ä¸­å¹¹çš„æ´»å°±æ˜¯ä¸æ–·å°‡ <code>start</code> index ä¸Šçš„å…ƒç´ èˆ‡å…¶å­æ¨¹æ¯”è¼ƒï¼Œè‹¥ä¸ç¬¦åˆ heap orderingï¼Œå‰‡å…©è€…ç½®æ›ã€‚</p>
<ol>
<li><strong>æ˜¯å¦æœ‰å­çµé»</strong>ï¼šä¾ç…§ binary heap çš„å®šç¾©æ‰¾å‡º root çš„å·¦å­æ¨¹ï¼ˆleft substreeï¼‰ï¼Œè‹¥å·¦å­æ¨¹çš„ index <code>child</code> æ¯” <code>end</code> é‚„å¤§ï¼Œè¡¨ç¤ºæ²’æœ‰ heap æ²’æœ‰å­çµé»ï¼Œåœæ­¢è¿­ä»£ã€‚</li>
<li><strong>æª¢æŸ¥å³å­æ¨¹å€¼è¼ƒå¤§</strong>ï¼šè‹¥ root ä¸‹æœ‰å³å­æ¨¹ä¸”è¼ƒå¤§ï¼Œæˆ‘å€‘æœƒæ¨™è¨˜å³å­æ¨¹ï¼Œä¸¦åœ¨ä¸‹ä¸€æ­¥å°å³å­æ¨¹é€²è¡Œè™•ç†ã€‚</li>
<li><strong>ç½®æ›</strong>ï¼šè‹¥ <code>root</code> å…ƒç´ æ¯” <code>child</code> çš„å…ƒç´ å°ï¼Œå‰‡ç½®æ›å…©è€…ï¼Œä¸¦å°‡ <code>child</code> è¨­ç½®ç‚ºä¸‹å€‹è¿­ä»£çš„ <code>root</code>ï¼Œç¹¼çºŒæª¢æŸ¥æœ€åˆçš„ <code>start</code> å…ƒç´ æ˜¯å¦æ»¿è¶³ heap orderingã€‚</li>
</ol>
<p>ä»¥ä¸Šå°±æ˜¯ç°¡å–®çš„ <code>sift_down</code> å¯¦ä½œï¼Œä¹Ÿæ˜¯æ•´å€‹ heapsort çš„ç²¾é«“ã€‚</p>
<a class="header" href="#reference" id="reference"><h2>Reference</h2></a>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Wiki: Heap</a></li>
<li><a href="https://en.wikipedia.org/wiki/Heapsort">Wiki: Heapsort</a></li>
<li><a href="www.cs..html">CMSC 351 Algorithms, Fall, 2011, University of Maryland.</a></li>
<li>Sorting GIF by RolandH <a href="http://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA-3.0</a> via Wikimedia Commons.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../sorting/" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../sorting/quicksort/" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="../../sorting/" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="../../sorting/quicksort/" class="nav-chapters next" title="Next chapter ../../" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        
        <!-- Google Analytics Tag -->
        <script type="text/javascript">
            var localAddrs = ["localhost", "127.0.0.1", ""];

            // make sure we don't activate google analytics if the developer is
            // inspecting the book locally...
            if (localAddrs.indexOf(document.location.hostname) === -1) {
                (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-118441906-1', 'auto');
                ga('send', 'pageview');
            }
        </script>
        

        

        

        
        <script src="../../searchindex.js" type="text/javascript" charset="utf-8"></script>
        
        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

    </body>
</html>
